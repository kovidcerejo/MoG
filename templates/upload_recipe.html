{% extends "layout.html" %}

{% block title %}
    Upload Recipe
{% endblock %}

{% block body %}
    <h1>Upload your own recipe</h1>
    <form action="/recipes/upload" method="POST" class="container" id="upload-recipe" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="typeahead-name" class="form-label">Volunteer Name</label>
            <br>
            <input type="text" name="creator_name" id="typeahead-name" required autocomplete="off" class="form-control">
        </div>
        <div class="mb-3">
            <label for="recipe_name" class="form-label">Recipe Name</label>
            <input type="text" autocomplete="off" id="recipe_name" name="recipe_name" class="form-control" placeholder="Recipe Name" required>
        </div>
        <div class="mb-3">
            <label for="ingredients" class="form-label">Ingredients</label>
            <textarea id="ingredients" class="form-control" name="ingredients" placeholder="List ingredients" required rows="8"></textarea>
        </div>
        <div class="mb-3">
            <label for="instructions" class="form-label">Instructions</label>
            <textarea id="instructions" class="form-control" name="instructions" placeholder="Instructions" required rows="8"></textarea>
        </div>
        <div class="mb-3">
            <label for="image-upload" class="form-label">Recipe image (optional)</label>
            <input type="file" id="image-upload" class="form-control" name="image" accept="image/*">
        </div>
        <button type="submit" class="btn btn-primary">Submit Recipe</button>
    </form>
{% endblock %}
{% block scripts %}
<script>
  $(document).ready(function () {
    const volunteers = {{ volunteers | map(attribute='creator_name') | list | tojson | safe }};

    $('#typeahead-name').typeahead({
      hint: true,
      highlight: true,
      minLength: 1
    }, {
      name: 'volunteers',
      source: function (query, syncResults) {
        const matches = [];
        const regex = new RegExp(query, 'i');

        volunteers.forEach(volunteer => {
          if (regex.test(volunteer)) {
            matches.push(volunteer);
          }
        });

        syncResults(matches);
      }
    });

    $('#volunteer-form').on('submit', function(e) {
      const val = $('#typeahead-name').val().trim();
      if (!volunteers.includes(val)) {
        e.preventDefault();
        alert('Please select a valid volunteer name from the list.');
        $('#typeahead-name').focus();
      }
    });
  });
</script>

{% endblock %}